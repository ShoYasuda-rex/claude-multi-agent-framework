---
name: team
description: 並列実行。リーダー（メインチャット）は調整のみ、サブエージェントが実装・調査を行う
tools: Read, Glob, Grep, Write, Edit, Bash, Task, WebSearch, WebFetch, AskUserQuestion, TaskCreate, TaskUpdate, TaskList, TeamCreate, SendMessage
user_invocable: true
model: opus
---

# /team

ユーザーの直前の指示を並列で実行する。メインチャットはリーダーとして調整のみ行い、実装・調査はサブエージェントに委譲する。

**引数 `research`** が指定された場合は「プリセット: research」セクションのフローに従う。

## リーダーの原則

1. **自分では実装・調査しない。** ファイル編集、WebSearch等の実作業はすべてサブエージェントに委譲する。
2. **タスク分析 → 実行形態の判断 → 委譲 → 統合 → 報告。** これだけがリーダーの仕事。
3. **コンテキストを守れ。** サブエージェントに作業させることで、リーダーのコンテキストウィンドウを圧縮する。

---

## 通常モード（引数なし）

### 1. タスク分析

ユーザーの直前の指示を分析し、タスクの性質を判定する：

- **実装タスク**: コード変更・ファイル作成・バグ修正など
- **調査タスク**: 情報収集・比較・分析など
- **混合**: 調査してから実装するなど

### 2. 実行形態の判断

タスクの規模・性質に応じて、**チーム（TeamCreate）** か **サブエージェント（Task単発）** かを選択する。

#### サブエージェント（Task単発）を使う場合

- タスクが1〜3個で、依存関係がない or 少ない
- 各タスクが独立して完結する（途中の相互連携が不要）
- 短時間で終わる作業

→ **Taskツールで並列起動するだけでよい。TeamCreate不要。**

#### チーム（TeamCreate）を使う場合

- タスクが4個以上、または途中で相互に依存する
- 作業途中でメンバー間のメッセージ連携が必要
- フェーズが複数ある（調査→設計→実装など段階的に進む）
- タスクの進行状況を管理する必要がある

→ **TeamCreate + TaskCreate + SendMessage で管理する。**

### 3. タスク分割

実行可能な単位に分割する。分割の基準：

- 各タスクが独立して実行可能か
- 同一ファイルを編集するタスクは1つのエージェントにまとめる
- 2〜5個を目安（多すぎると統合コストが上がる）

### 4. サブエージェント起動

**1つのメッセージで全エージェントを並列起動する。**

#### 実装タスクの場合

実装担当には**Taskツールでサブエージェントを呼ぶことを推奨**する。
実装担当が自分の判断で必要な調査をExploreエージェントに委譲することで、実装コンテキストを汚さず精度が上がる。

```
Task tool:
  subagent_type: general-purpose
  mode: bypassPermissions
  prompt: |
    以下のタスクを実装してください。
    EnterPlanModeは使うな。AskUserQuestionは使うな。確認せず即実行しろ。

    ## 実装方針
    - コード調査が必要な場合は、自分で直接Grep/Globするのではなく、
      Taskツール（subagent_type: Explore）でサブエージェントを起動して調査を委譲しろ。
    - 例: 依存関係の確認、既存パターンの調査、影響範囲の特定など
    - 複数の調査が必要なら並列で起動しろ。
    - 調査結果を受け取ってから実装に集中しろ。

    ## タスク
    タスク: {task_description}
    対象ファイル: {files}
    コンテキスト: {context}
```

#### 調査タスクの場合

各エージェントに**異なる視点・観点**を割り当てる。同じ調査を複数に投げない。

```
Task tool:
  subagent_type: general-purpose（WebSearch要） or Explore（コード調査）
  prompt: |
    以下の観点で調査してください。

    調査テーマ: {theme}
    担当観点: {perspective}
    報告フォーマット: 発見 → 根拠 → 示唆
```

### 5. 結果統合・報告

全エージェントの結果を統合し、ユーザーに報告する。

- **実装の場合**: 変更内容・変更ファイル一覧をまとめて報告
- **調査の場合**: 発見事項を優先度順に整理して報告
- **矛盾があれば明記**: エージェント間で結果が食い違う場合はそのまま報告する

---

## プリセット: research（`/team research`）

3つの視点からサブエージェントで並列調査し、結果を統合して報告する。
オプションで調査結果をそのまま実装まで進められる。

### ルール

1. **体感インパクトで優先度をつけろ。** 判定基準: 改善したらユーザーが違いに気づくか？
2. **統合せよ。** 3視点の結果を突き合わせ、重複排除・優先度付けして報告。
3. **聞くのは起動時だけ。** テーマ確認 + 実装モード選択。それ以降は聞かない。

### フロー

1. ユーザーに調査テーマを確認（指定なしならプロダクト全体）
2. ユーザーに実行モードを確認:
   - **調査のみ** → 調査レポートだけ報告して終了
   - **調査＋実装** → 調査結果をそのまま実装・検証まで進める
3. docs/CORE.md があれば読む
4. A/B/C を Task で**並列起動**（1つのメッセージで3つ同時）
5. 結果を統合して報告（体感インパクト順）
6. **実装モードの場合のみ**:
   a. 改善項目をタスク分割
   b. 実装担当を並列起動（Task general-purpose, mode: bypassPermissions）
   c. 検証: `/verify` で品質チェック
   d. CRITICALが出たら修正
   e. 実施内容・変更ファイルを報告して終了

### 調査員（サブエージェント）

| 調査員 | 視点 | subagent_type |
|--------|------|---------------|
| **A** | ユーザー体験（Playwrightで実操作） | general-purpose |
| **B** | プロダクト品質（CORE.md逆算、コード・a11y） | Explore |
| **C** | 競合・トレンド（WebSearch） | general-purpose |

### 調査員への指示

#### A（UX調査）
```
このプロダクトの主要画面をPlaywrightで操作し、ユーザー体験を調査してください。
調査コードは書かないでください。Playwright MCPツール（browser_navigate, browser_snapshot, browser_click等）を直接使ってください。

観点:
- ユーザーフローで引っかかる箇所
- 「あったら嬉しい」のに存在しない機能・インタラクション
- モバイル/デスクトップでのレイアウト崩れ（体験に影響するレベルのみ）
- インタラクションの違和感（ローディング、フィードバック不足等）
- エラー時の体験

重要: 「改善したらユーザーが体感できるもの」を優先して報告せよ。余白1pxのズレや色コードの微差など開発者しか気づかないレベルの指摘は不要。
報告フォーマット: 発見（何が起きているか）→ 体感への影響（ユーザーはどう困るか/何が嬉しくなるか）→ 改善イメージ

対象テーマ: {theme}
ローカルサーバー: {url}
```

#### B（プロダクト品質調査）
```
CORE.mdとARCHITECTURE.mdを基準に、現在の実装を逆算チェックしてください。

観点:
- CORE.mdの体験方針とコードの乖離（ユーザー体験に影響するもの）
- CORE.md/ARCHITECTURE.mdの仕様と実装の差分（機能が動かない/欠けているもの）
- アクセシビリティ（ARIA、キーボード操作、コントラスト — 実際に使えないレベルのもの）
- 未実現の体験（CORE.mdが描く理想に対して、まだ作られていないもの）

重要: 「改善したらユーザーが体感できるもの」を優先して報告せよ。変数名の統一、コメント追加、コード整理など開発者しか気づかないレベルの指摘は不要。
報告フォーマット: 発見（何が足りないか）→ 体感への影響（ユーザーはどう困るか/何が嬉しくなるか）→ 改善イメージ

対象テーマ: {theme}
```

#### C（競合・トレンド調査）
```
WebSearchで類似サービス・業界動向を調査してください。

観点:
- 類似サービス・競合の特徴的なUX/機能
- この分野の最新トレンド・ベストプラクティス
- ユーザーが期待しそうな機能・体験

重要: 「取り入れたらユーザーが体感できる変化」を優先して報告せよ。技術的なアーキテクチャ比較やコード構成の話は不要。
報告フォーマット: 発見（競合では何がある/トレンドは何か）→ 体感への影響（取り入れたらユーザーは何が嬉しいか）→ 導入イメージ

対象テーマ: {theme}
プロダクト概要: {product_summary}
```

### 統合報告フォーマット

```
## 統合調査レポート
### テーマ: {theme}

### 発見事項（体感インパクト順）
1. **[High]** 〇〇 — 改善したらユーザーが即座に気づくレベル（根拠: A/B共通）
2. **[Medium]** 〇〇 — 体験が明確に良くなる（根拠: Cの競合調査から示唆）
3. **[Low]** 〇〇 — あれば嬉しいが優先度は低い

### 改善提案
| # | 提案 | 体感の変化 | 根拠（調査員） |
|---|------|-----------|---------------|
| 1 | ... | ユーザーは○○が変わったと感じる | A, B |
| 2 | ... | ユーザーは○○できるようになる | C |
```

### 実装モード時の追加報告

```
### 実装結果
| # | 改善内容 | 変更ファイル | 検証結果 |
|---|---------|-------------|---------|
| 1 | ... | file1.js, file2.css | PASS |
| 2 | ... | file3.html | PASS |
```
