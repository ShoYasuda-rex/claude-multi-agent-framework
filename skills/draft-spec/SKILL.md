---
name: draft-spec
description: サービス仕様方針（UX・振る舞い）を整理
user_invocable: true
disable-model-invocation: true
argument-hint: "[プロジェクト名 または 要件ドキュメントのパス]"
---

# Spec Designer（サービス仕様方針）

CORE.md（Why）と実装（What）の間にある「How」を定義するスキル。
サービスとしてどう振る舞うか、ユーザーにどんな体験を提供するかを言語化する。
技術的な実装方法には触れない。出力は docs/SPEC.md。

---

## 前提

- 通常モード: CORE.md が存在すること（なければ「先に /core-draft でCoreを整理しよう」と伝えて終了）
- インポートモード: CORE.md がなくてもインポートドキュメントがあれば続行可能

---

## 起動時の動作

まず $ARGUMENTS がファイルパスかどうかを判定する。

**ファイルパス判定:** $ARGUMENTS が以下のいずれかに該当すればファイルパスとして扱う:
- 拡張子が `.md` / `.txt` / `.pdf` で終わる
- パス区切り（`/` または `\`）を含む

- **ファイルパスである** → インポートモードへ
- **ファイルパスでない** → 以下の通常フローへ（$ARGUMENTS はプロジェクト名として扱う）

1. CORE.md を読み込み、要件を把握する
2. `docs/SPEC.md` の存在を確認する
   - **存在しない** → 新規作成モードへ（`docs/` ディレクトリがなければ作成）
   - **存在する** → 編集モードへ

---

## インポートモード

$ARGUMENTS がファイルパスと判定された場合に適用。

### Step 1: ドキュメント読み込み
- Read ツールで $ARGUMENTS のファイルを読み込む
- 読み込み失敗時は「ファイルが見つからなかった。パスを確認して」と伝えて終了
- CORE.md が存在すればそれも併せて読み込む（なくても続行可）

### Step 2: 内容の抽出・整理
- ドキュメントから、出力フォーマットの各セクションに該当する情報を抽出・整理する:
  - 体験の全体像
  - トーン & マナー
  - 判断の方針
  - やってはいけない体験
  - エッジケースの対応方針
  - 成功の手触り
- 抽出結果をチャット上に提示:「持ち込みドキュメントからこう読み取りました」

### Step 3: 不足項目のヒアリング
- 出力フォーマットの全セクションを照合し、カバーされていない項目を特定
- 不足項目のみ AskUserQuestion でヒアリング（カバー済み項目はスキップ）
- ユーザーが「それでいい」と言えばそのまま進む

### Step 4: 壁打ち
- 新規作成モードと同じ壁打ちを行う（体験の一貫性・ユーザーの離脱ポイント・エッジケースの方針）
- 壁打ちで新たに見えたことがあれば内容を更新する

### Step 5: 確認
- 最終的な整理結果を提示し、「これで合ってる？」と確認

### Step 6: 出力
- 出力フォーマットに従って docs/SPEC.md を生成する

---

## 新規作成モード

### Step 1: 要件の確認

CORE.md の内容を簡潔に提示し、「この理解で合っている？」と確認する。
ズレがあれば先に CORE.md を修正するよう促す。

### Step 2: ヒアリング

以下の順序で AskUserQuestion を使って質問する。**1つずつ聞く**（まとめて聞かない）。
ユーザーが「わからない」「まだ決まってない」と答えたら、無理に詰めず「一旦空欄にして次へ進もう」と伝えて先に進む。

1. **ユーザー体験の流れ**: 「ユーザーが最初に触れてから、ゴールに辿り着くまで、どんな流れを想像してる？」
2. **サービスの人格・トーン**: 「このサービス（またはキャラクター）はどんな話し方・距離感で接する？」
3. **判断の基準**: 「ユーザーが迷った時、このサービスはどういうスタンスを取る？（導く？選ばせる？後押しする？）」
4. **やってはいけない体験**: 「ユーザーに絶対させたくない体験は？（例：責められてる感じ、放置される感じ）」
5. **成功の手触り**: 「使い終わった時、ユーザーにどんな気持ちになっていてほしい？」

### Step 3: 軌道修正

ユーザーが以下に逸れたら戻す：

| 逸れた内容 | 戻し方 |
|-----------|--------|
| 技術選定・実装方法 | 「作り方は後。まずどんな体験にするか決めよう」 |
| 画面レイアウト・UI部品 | 「UIは後。まずユーザーの体験の流れを固めよう」 |
| 機能の詳細仕様 | 「機能仕様は実装時に決める。今はサービスの振る舞い方針を決めよう」 |
| ビジネスモデル | 「マネタイズは別の話。今はユーザー体験に集中しよう」 |

### Step 4: 壁打ち

ヒアリング内容をもとに、以下の観点で壁打ちする。1つずつ質問する。

- **体験の一貫性**: 「最初から最後まで、トーンや距離感はブレてない？途中で急に冷たくなったりしない？」
- **ユーザーの離脱ポイント**: 「この流れの中で、ユーザーが『もういいや』となりそうなポイントはどこ？どう防ぐ？」
- **エッジケースの方針**: 「ユーザーが想定外の使い方をした時（何も入力しない、ネガティブなことを言うなど）、どう対応する？」

壁打ちで新たに見えたことがあれば、ヒアリング内容を更新する。

### Step 5: 出力

壁打ち完了後、出力フォーマットに従って docs/SPEC.md を生成する。

---

## 編集モード

### Step 1: 現状確認

CORE.md と docs/SPEC.md を読み込み、要約を提示する：
- 要件の概要
- 現在の体験フロー
- トーン&マナー
- 判断方針
- やってはいけない体験

### Step 2: 変更箇所の確認

「どこをどう見直したい？」とフリーワードで聞く。

### Step 3: 更新

指定された箇所のみ更新して保存する。

---

## 出力フォーマット

docs/SPEC.md は以下のフォーマットで生成する。$ARGUMENTS が指定されていればプロジェクト名として使う。

```markdown
# プロジェクト名 — サービス仕様方針

## 体験の全体像
（ユーザーが最初に触れてからゴールまでの流れ。技術ではなく体験として描く）
1. ステップ1: ユーザーは何をして、何を感じるか
2. ステップ2: ...
3. ...

## トーン & マナー
（サービス全体の話し方・距離感・人格）
- 基本トーン: （例：温かく寄り添う、でも甘やかさない）
- 言葉遣い: （例：敬語だが堅すぎない、友人のような距離感）
- 禁止表現: （例：否定語、命令形、専門用語）

## 判断の方針
（ユーザーが迷った時、サービスがどうするか）
- 基本スタンス: （例：答えを教えるのではなく、引き出す）
- 介入のライン: （例：ここまでは見守る、ここからは助ける）

## やってはいけない体験
（ユーザーに絶対させたくないこと）
- xxx
- xxx

## エッジケースの対応方針
（想定外の状況にどう対応するか）
- ケース1: → 対応方針
- ケース2: → 対応方針

## 成功の手触り
（使い終わった時、ユーザーにどんな気持ちでいてほしいか）
```

---

## ルール

1. **体験に集中** — 技術・実装・UIコンポーネントの話は書かない
2. **ユーザー視点で書く** — 「システムが〇〇する」ではなく「ユーザーが〇〇と感じる」
3. **具体的に書く** — 「寄り添う」だけでなく「どう寄り添うか」まで
4. **CORE.md との整合性** — 要件で定義した課題・ゴールと矛盾しない
5. **短く保つ** — 1-2ページが理想
6. **このスキルで作るのは docs/SPEC.md のみ** — 実装計画は別スキル（plan-assist）

## アンチパターン（これを出力してはいけない）

悪い例（実装を書いている）:
```
## 体験の全体像
1. トップページでステップ一覧を表示する
2. チャット画面でOpenAI APIを呼び出す
3. localStorageに保存する
```

良い例（体験を書いている）:
```
## 体験の全体像
1. 全体の見通しを知る: 「こんな流れで進むよ」と先が見えることで安心する
2. 対話で自分を知る: 聞かれて答えるうちに、自分でも気づかなかった強みが言葉になる
3. 整理された自分を見る: バラバラだった自分の経験が、1つのストーリーとしてまとまっている
```
