---
name: load-plans
description: 保存済み計画の読み込みと実行
tools: Read, Glob, Grep, Write, Edit, Bash, Task, AskUserQuestion
user_invocable: true
---

# Load Plans（計画読み込み＆実行）

`.claude/plans/` に保存された計画を読み込み、競合分析を行い、実行方式を提案・実行する。

---

## 手順

### 1. 計画ファイルの取得

- `.claude/plans/*.md`（ルート直下のみ）を Glob で取得する（`done/` サブディレクトリは対象外）
- ファイルが見つからない場合:
  - 「保存された計画がありません。`/save-plan` で計画を保存してください」と案内して終了

### 2. 計画の読み込み

各計画ファイルを Read で読み込み、以下を抽出する:
- 計画名（`#` 見出しから）
- ステータス（「未実行」のもののみ対象。「完了」「実行中」は除外）
- 変更対象ファイル一覧
- 実行ステップ

### 3. 競合分析

- 全計画の「変更対象ファイル」を突き合わせ、重複を検出する
- 重複があるペアを「競合あり」と判定する

### 4. 分析結果の表示

```
## 保存された計画（未実行）

| # | ファイル名 | 概要 | 変更ファイル数 | 競合 |
|---|-----------|------|---------------|------|
| 1 | {filename} | {summary} | {count} | なし |
| 2 | {filename} | {summary} | {count} | #3と競合（file.js） |

## 競合マップ（競合がある場合のみ）
- `path/to/file.js` → 計画#2, 計画#3 が同時に変更

## 推奨実行方式
- 競合なし → `.tpi` で全並列実行
- 一部競合 → 競合グループ内は直列（blockedBy設定）、グループ間は並列
- 全競合 → 直列実行
```

### 5. 実行方法の確認

AskUserQuestion で確認する:

- 「どう実行しますか？」
  - 推奨方式で実行（推奨）: 競合分析に基づく最適な方式
  - 全て並列で実行: 競合リスクを受け入れて全並列
  - 選択して実行: 特定の計画だけ選んで実行
  - 確認のみ: 実行せず終了

### 6. 実行

- `.tpi` のフロー（CLAUDE.md のショートカット参照）に従い、タスクを構成する
- メインは調整役のみ（実装しない）
- 各計画の実行ステップをそのままタスクの指示として使用する
- 競合する計画間には依存関係（blockedBy）を設定する

### 7. 完了処理

- 完了した計画ファイルのステータスを Edit で「完了」に更新する
- `.claude/plans/done/` ディレクトリがなければ Bash で作成する
- 完了した計画ファイルを `.claude/plans/done/` に移動する（Bash の `mv` を使用）
- 結果サマリーを表示する

---

## 禁止事項

- 「完了」「実行中」ステータスの計画を再実行しない
- 計画の実行ステップを勝手に変えない（保存された内容をそのまま実行する）
- 競合する計画を確認なしで並列実行しない
