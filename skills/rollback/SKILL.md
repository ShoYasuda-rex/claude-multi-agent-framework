---
name: rollback
description: gitローカルコミットから復元
model: haiku
user_invocable: true
disable-model-invocation: true
---

# Restore（バックアップからの復元）

過去のgitコミット（backupスキルで作成されたもの含む）から復元する。

---

## 手順

### 1. git リポジトリ確認

- `.git` が存在するか確認
- なければ「gitリポジトリが見つかりません。/backup で先にコミットしてください」と報告して終了

### 2. 現在の状態を確認

- `git status` で未コミットの変更があるか確認
- 未コミットの変更がある場合、ユーザーに警告:
  - 「未コミットの変更があります。復元すると失われます。先に /backup しますか？」
  - ユーザーが「はい」→ backupスキル相当の処理を行ってから続行
  - ユーザーが「いいえ」→ 続行（変更は失われる旨を再度確認）

### 3. コミット履歴の表示

- `git log --oneline -20` で直近20件のコミット履歴を表示
- 各コミットのハッシュ・メッセージ・日時を見やすく整形して表示

### 4. 復元先の選択

- ユーザーにどのコミットに戻るか選んでもらう（コミットハッシュまたは番号）

### 5. 復元方法の選択

ユーザーに復元方法を確認:

- **安全な復元（推奨）**: `git revert --no-commit <対象以降のコミット>` → 新しいコミットとして復元。履歴が残る
- **完全な巻き戻し**: `git reset --soft <コミット>` → 指定コミットまで戻し、それ以降の変更はステージングに残す。コミット履歴は消える

### 6. 復元の実行

- 選択された方法で復元を実行
- 復元後に `git log --oneline -5` と `git status` で状態を確認

### 7. 完了報告

- 復元結果のサマリーを報告
- 復元されたコミットのハッシュとメッセージを表示

---

## 禁止事項

- `git reset --hard` は使わない（変更が完全に消えるため）
- `git push --force` はしない
- ユーザーの確認なしに復元を実行しない
- 未コミットの変更がある場合、確認なしに上書きしない
