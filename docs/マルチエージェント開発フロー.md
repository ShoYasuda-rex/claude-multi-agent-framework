	# マルチエージェント開発フロー

個人開発で、品質を保ちながら高速開発するためのフレームワーク。

- 1人でチーム相当の開発品質を実現する
- 品質はエージェントによるテスト・静的検証・動的検証で担保する
- AIは「作る・調べる・報告する」。人間は「決める・選ぶ・承認する」

**思想**: 要件は変わる。だから仕様は固めない。CORE.md で「なぜ作るか」、ARCHITECTURE.md で「どう作るか」を書き、動くものから育てる。

---

## 目次

1. [開発フロー全体像](#開発フロー全体像)
2. [ドキュメント体系](#ドキュメント体系)
3. [ツール](#ツール)
4. [リリース・障害対応](#リリース・障害対応)
5. [付録A: セットアップ](#付録a-セットアップ)
6. [付録B: 検知カバレッジ](#付録b-検知カバレッジ)
7. [付録C: モデル配分](#付録c-モデル配分)

---

## 開発フロー全体像

```
【起点】
ブラウザ版Claudeで壁打ち → 何を作るかのたたき台

【設計】
1. /draft       → たたき台を docs/BRAINSTORM.md に保存 + docs/CORE.md + docs/ARCHITECTURE.md 生成

【構築】
2. /infra-setup       → Git初期化・GitHub・プラットフォーム作成
3. /infra-setup-guard  → 守りのインフラ（DBバックアップ・ブランチ・エラー監視）
4. /infra-setup-connect → 本番接続（デプロイ・環境変数・外部API・ドメイン・DB・スモークテスト）

【実装・検証】（繰り返す）
5. /local       → ローカルサーバー起動
6. 実装指示     → 自動でタスク分割＋並列実装
7. /verify      → 品質チェック
8. /deploy      → デプロイ

【リリース前】
/infra-setup    → 運用基盤の検証（検証モード）
/audit          → 一括監査
```

**随時**: `/backup`（git保存）、`/rollback`（巻き戻し）、`/gen-arch`（ドキュメント生成）、`/research-team`（改善調査）、`/market-team`（マーケ調査）

---

## ドキュメント体系

```
docs/BRAINSTORM.md（たたき台）
  ブラウザ版Claudeでの壁打ち結果
      ↓
docs/CORE.md（Why）
  誰の課題を・どう解決するか
      ↓
docs/ARCHITECTURE.md（How）
  技術スタック / 構成 / データモデル / API設計
      ↓
CLAUDE.md + 実装コード

────────────────────────────
docs/current/（コードの実態 — /gen-arch で逆引き生成）
├── architecture.md
├── screen-flow.md
└── component-rules.md
```

---

## ツール

### 一覧

| コマンド | 概要 |
|--------|------|
| `/verify` | 品質チェック（テスト・静的検証・動的検証）を選択して並列実行 |
| `/audit` | 監査（コード・セキュリティ・設計・法令）を選択して並列実行 |
| `/deploy` | git add → commit → push。`safe` で安全モード |
| `/local` | ローカルサーバーを起動してブラウザで開く |
| `/draft` | 対話で docs/CORE.md + docs/ARCHITECTURE.md を作成・編集 |
| `/infra-setup` | モード判定 + Git初期化・GitHub・プラットフォーム作成 + 全項目検証モード |
| `/infra-setup-guard` | 守りのインフラ（DBバックアップ・ブランチ戦略・エラーハンドリング・監視） |
| `/infra-setup-connect` | 本番接続（デプロイ設定・環境変数・外部サービス・ドメイン・本番DB・スモークテスト・完了記録） |
| `/gen-arch` | コード実態からアーキテクチャドキュメントを自動生成 |
| `/backup` | 現在の状態をgitコミットで保存（pushしない） |
| `/rollback` | 直近20件から復元先を選択（`reset --hard` は使わない） |
| `/research-team` | UX・コード・競合の3視点で並列調査 |
| `/market-team` | 訴求・チャネル・競合の3視点でマーケ調査 |
| `/feature-trainer` | フレームワーク学習（入門）。小さなフロントエンドプロダクトを1つ作り切る（1日） |
| `/fullstack-trainer` | フルスタック学習（中級）。DB+API+Workersを加えたプロダクトを1つ作り切る（2日） |
| `/solo-trainer` | 自走で開発を回す練習。次の1手を指示するトレーナー |

### /feature-trainer

**用途**: フレームワーク学習（入門）。IT未経験者でもOK

```
/feature-trainer
```

フロントエンドのみの小さなプロダクトを1日で作り切り、開発フローの型を身体で覚える。

| 項目 | 内容 |
|------|------|
| 対象 | IT基礎知識なし〜初心者 |
| 技術 | フロントエンドのみ（HTML/CSS/JS, React, Vue等） |
| ホスティング | Cloudflare Pages |
| DB/認証/API | なし |
| 期間 | 1日 |

フロー: テーマ選択 → 環境構築 → スコープ固定 → /draft → 実装 → /verify → /deploy → 振り返り

- レベル1〜3のテーマを提示（初回はレベル1推奨）
- 専門用語は初出時に必ず平易な説明を添える
- テーマを変えて繰り返し使える

### /fullstack-trainer

**用途**: フルスタック学習（中級）。feature-trainer修了者向け

```
/fullstack-trainer
```

DB + 外部API + Workersを加えた小さなフルスタックプロダクトを2日で作り切る。

| 項目 | 内容 |
|------|------|
| 対象 | /feature-trainer を1回以上完走した人 |
| フロントエンド | テーマに応じて指定 |
| バックエンド | Cloudflare Workers |
| DB | Cloudflare D1（テーブル2以内） |
| キャッシュ | Cloudflare KV |
| 外部API | 無料API 1つ |
| エンドポイント | 5以内 |
| 認証 | レベル1-2: なし / レベル3: Clerk |
| デプロイ | GitHub Actions による自動デプロイ |
| 期間 | 2日 |

フロー: 前提確認 → テーマ選択 → 環境構築 → スコープ固定 → /draft → **DB設計** → 実装 → /verify → /deploy → 振り返り

- feature-trainerと同じ型。道具が増えるだけ
- DB設計フェーズが新規追加（テーブル定義・マイグレーション）
- 外部APIはWorkers経由で呼ぶ（APIキー秘匿・CORS回避）
- テーマを変えて繰り返し使える

### 学習パス

```
/feature-trainer（入門・1日）
    ↓ フロントエンドの型を習得
/fullstack-trainer（中級・2日）
    ↓ DB+API+Workersの型を習得
/solo-trainer（実践）
    ↓ 自走で開発フローを回す
本番開発（手動フロー）
```

### /draft

**成果物**: docs/CORE.md + docs/ARCHITECTURE.md（なければ新規作成、あれば編集モード）

CORE.md:
```markdown
# プロジェクト名
## 誰のためのサービスか
## 何に困っているか
## どうなったら嬉しいか
## なぜ既存の方法ではダメか
## やらないこと
## 一言で言うと
```

ARCHITECTURE.md:

**セキュリティレベル**（ヒアリングで確定 → CLAUDE.mdに記録）:
- `basic`: 認証なし、外部連携なし
- `standard`: 認証あり、ユーザーデータ保存あり
- `strict`: 決済・機密個人情報を扱う

```markdown
# プロジェクト名 — アーキテクチャ設計
## 技術スタック
## ディレクトリ構成
## コンポーネント分割
## データモデル
## API設計
## 認証・権限設計
## エラーハンドリング・監視
## やらないこと（技術的スコープ外）
```

### /verify

選択肢（複数選択可、デフォルト: 全て実行）:

| エージェント | 対象 |
|------------|------|
| test-checker | テスト生成＋実行（ユニット・インテグレーション・E2E） |
| code-checker | 依存関係・リント・型チェック・ビルド確認（変更ファイル対象） |
| visual-checker | ブラウザで画面確認 |

> **code-checker vs audit-code-checker**: code-checker は変更ファイルの軽量チェック（実装直後用）。audit-code-checker はプロジェクト全体の包括的監査（リリース前用）。

### /audit

選択肢:

| エージェント | 対象 |
|------------|------|
| audit-code-checker | コード品質・構造の包括的監査 |
| audit-security-checker | 脆弱性・認証・秘密情報の検査 |
| audit-architecture-checker | 設計判断の妥当性レビュー |
| audit-law-checker | 法令遵守チェック |

### /deploy

- `/deploy` — 即実行（add → commit → push）
- `/deploy safe` — 保護ブランチ警告、コンフリクト検出、デプロイ前後にログ自動チェック

---

## リリース・障害対応

### リリース

```
1. /infra-setup → 運用基盤チェック（初回: セットアップ / 2回目以降: 検証）
2. /audit       → 一括監査
3. /deploy safe → 安全デプロイ
```

定期メンテナンス: `/audit` でコード監査・セキュリティ監査を選択して確認

### 障害対応

**検知**: 監視ツール（UptimeRobot / Pushover）、ユーザー報告、`/deploy safe` のログチェック

**対応**:
```
1. 原因特定（ログ・エラー内容を確認）
2. 修正可能か？ → No: /rollback → 4へ
3. 修正 → /verify → /deploy safe
4. rules/learned.md に記録
```

---

## 付録A: セットアップ

### ファイル配置

```
~/.claude/
├── agents/
│   ├── code-checker.md
│   ├── visual-checker.md
│   ├── test-checker.md
│   ├── audit-code-checker.md
│   ├── audit-security-checker.md
│   ├── audit-architecture-checker.md
│   ├── audit-law-checker.md
│   └── log-checker.md
│
└── skills/
    ├── draft/
    ├── gen-arch/
    ├── deploy/
    ├── verify/
    ├── audit/
    ├── backup/
    ├── rollback/
    ├── research-team/
    ├── market-team/
    ├── local/
    ├── infra-setup/
    ├── infra-setup-guard/
    ├── infra-setup-connect/
    ├── solo-trainer/
    ├── feature-trainer/
    └── fullstack-trainer/
```

### settings.json

- `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS: "1"` — Agent Teams を有効化
- deny/ask リストで危険な操作を制御
- Playwright プラグイン有効

### ~/.claude/CLAUDE.md（共通ルール）

- 実装タスクのフロー（CORE.md参照 → 依存関係確認 → 設計 → 並列実装 → 報告）
- 依存関係の確認ルール（変更前に影響範囲を検索）
- エラーの学習（修正したら `rules/learned.md` に記録）

---

## 付録B: 検知カバレッジ

各検証手段が何を検知するかのマトリクス。

| 破壊の種類 | /verify 静的 | /verify 動的 | /verify テスト | /audit コード | /audit セキュリティ | /deploy ログ | /audit 法令 |
|-----------|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| import/requireの破壊 | ✓ | - | - | ✓ | - | - | - |
| CSSセレクタ不一致 | ✓ | ✓ | - | - | - | - | - |
| 関数シグネチャ変更 | ✓ | - | ✓ | - | - | - | - |
| ルーティング破壊 | - | ✓ | ✓ | ✓ | - | - | - |
| レイアウト崩れ（ピクセル） | - | ✓ | - | - | - | - | - |
| レイアウト崩れ（要素・遷移） | - | ✓ | ✓ | - | - | - | - |
| JSランタイムエラー | △ | ✓ | ✓ | - | - | - | - |
| APIレスポンスエラー | - | ✓ | ✓ | - | - | ✓ | - |
| DBクエリ破壊 | - | ✓ | ✓ | - | - | - | - |
| 環境変数欠落 | - | ✓ | - | - | ✓ | - | - |
| コンソールエラー | - | ✓ | ✓ | - | - | - | - |
| リント違反 | ✓ | - | - | ✓ | - | - | - |
| 非同期処理の競合 | - | - | ✓ | - | - | - | - |
| データフロー不整合 | - | - | ✓ | ✓ | - | - | - |
| 外部サービス連携の破壊 | - | - | ✓ | - | - | - | - |
| 未使用ファイル・デッドコード | - | - | - | ✓ | - | - | - |
| 循環参照 | - | - | - | - | ✓ | - | - |
| ハードコード秘密情報 | - | - | - | - | ✓ | - | - |
| 型エラー / ビルドエラー | ✓ | - | - | - | - | - | - |
| テスト失敗 | - | - | ✓ | - | - | - | - |
| バージョン整合性・supply chain | - | - | - | - | ✓ | - | - |
| 認証・認可の脆弱性 | - | - | - | ✓ | ✓ | - | - |
| XSS・インジェクション | - | - | - | - | ✓ | - | - |
| ルート→ハンドラ→ビュー不在 | - | - | - | ✓ | - | - | - |
| モデル/スキーマ不整合 | - | - | - | ✓ | - | - | - |
| 認証フィルタ適用漏れ | - | - | - | ✓ | ✓ | - | - |
| Enum/定数の参照不整合 | - | - | - | ✓ | - | - | - |
| 本番クラッシュ・OOM | - | - | - | - | - | ✓ | - |
| パフォーマンス劣化（LCP/CLS等） | - | ✓ | - | - | - | ✓ | - |
| 502/503/504エラー | - | - | - | - | - | ✓ | - |
| 景品表示法・特商法 | - | - | - | - | - | - | ✓ |
| 個人情報保護法 | - | - | - | ✓ | - | - | ✓ |
| 著作権・商標 | - | - | - | - | - | - | ✓ |

---

## 付録C: モデル配分

壁打ち・設計判断・複雑な調査・包括的監査 → **opus**。構造的な生成・手順実行・差分チェック → **sonnet**。単純な記録・ルックアップ → **haiku**。

| モデル | ツール |
|-------|-------|
| **opus** | draft, feature-trainer, fullstack-trainer, visual-checker, audit-code/security/architecture-checker, research-team, market-team, infra-setup, infra-setup-guard, infra-setup-connect |
| **sonnet** | gen-arch, deploy, test-checker, code-checker, log-checker, audit-law-checker, solo-trainer |
| **haiku** | local, backup, rollback |
